# ItemCategoryTreePicker - Древовидный выбор категорий

## Описание

Компонент для древовидного выбора категорий элементов при создании/редактировании функций venue (Collection Point, Distribution Point).

## Отличия от старого ItemCategoryPicker

### До (ItemCategoryPicker - breadcrumb навигация)
```
All Categories > Medicine > Painkillers

[Nurofen]  [Paracetamol]  [Aspirin]
```
- Навигация через breadcrumb (как в файловом менеджере)
- Видна только одна категория за раз
- Много кликов для навигации
- Grid layout (2-4 колонки)

### После (ItemCategoryTreePicker - древовидная структура)
```
▼ Medicine (15)
  ▼ Painkillers (3)
    • Nurofen        [+ Add]
    • Paracetamol    [+ Add]
    • Aspirin        [+ Add]
  ▶ Antibiotics (5)
  ▶ First Aid (7)
▼ Food (10)
  ▶ Canned Food (4)
  ▶ Dry Food (6)
```
- Все категории видны одновременно
- Интуитивная иерархическая структура
- Быстрый доступ к любой категории
- Компактное отображение

## Особенности

### Визуальные индикаторы
- **Chevron (▼/▶)** - раскрытие/сворачивание категорий
- **Счётчик** - количество подкатегорий
- **+ кнопка** - добавить элемент (только для листовых узлов)
- **✓ иконка** - элемент уже добавлен

### Функциональность
- **Expand All / Collapse All** - глобальное раскрытие/сворачивание
- **Hover подсказки** - описание категории при наведении
- **Автоматическая синхронизация** - уже добавленные элементы помечены
- **Clear All** - очистка всех выбранных элементов

### Выбранные элементы
```
Selected Items (3)                           [Clear All]

┌──────────────────────────────────────────────────┐
│ Nurofen                                          │
│ Medicine → Painkillers                           │
│ [A lot] [Some] [Few]                          [×]│
└──────────────────────────────────────────────────┘
```

## Использование

### В странице редактирования функции
```tsx
import ItemCategoryTreePicker from '@/components/venue-functions/ItemCategoryTreePicker';

<ItemCategoryTreePicker
  selectedItems={selectedItems}
  onItemsChange={setSelectedItems}
/>
```

### Props

| Prop | Тип | Описание |
|------|-----|----------|
| `selectedItems` | `ItemWithQuantity[]` | Массив выбранных элементов |
| `onItemsChange` | `(items: ItemWithQuantity[]) => void` | Callback при изменении списка |

## Интеграция

Компонент интегрирован в:
- ✅ `/venues/[id]/functions/[functionId]/edit` - редактирование функции
- ✅ `/venues/[id]/functions/new` - создание новой функции

## Структура данных

### ItemWithQuantity
```typescript
{
  categoryId: 'cat-1-1-1',
  categoryPath: ['Medicine', 'Painkillers', 'Nurofen'],
  quantity: 'some' | 'a_lot' | 'few'
}
```

### CategoryHierarchy (построено из API)
```typescript
{
  category: {
    id: 'cat-1',
    name: 'Medicine',
    description: 'Medical supplies'
  },
  children: [
    {
      category: { id: 'cat-1-1', name: 'Painkillers' },
      children: [
        { category: { id: 'cat-1-1-1', name: 'Nurofen' }, children: [] }
      ]
    }
  ]
}
```

## Производительность

- **Рекурсивный рендеринг** - только раскрытые узлы
- **Локальное состояние** - каждый узел управляет своим раскрытием
- **Оптимально для** - до 500 категорий в дереве
- **Max height** - 500px с прокруткой

## Преимущества

### Для пользователя
- ✅ Видны все категории сразу
- ✅ Меньше кликов для навигации
- ✅ Интуитивная структура
- ✅ Быстрый поиск визуально
- ✅ Счётчики подкатегорий

### Для разработчика
- ✅ Переиспользуемый компонент
- ✅ Типобезопасность TypeScript
- ✅ Чистая архитектура
- ✅ Легко расширяемый

## Будущие улучшения

### Возможные добавления
1. **Поиск** - фильтрация категорий по имени
2. **Избранное** - закладки часто используемых категорий
3. **Массовый выбор** - выбор всех элементов из категории
4. **Drag & drop** - перетаскивание элементов
5. **Иконки** - кастомные иконки для категорий
6. **Сортировка** - по алфавиту, по популярности

## Пример использования

### Добавление элемента
1. Открыть страницу редактирования функции
2. Найти секцию "Add More Items"
3. Раскрыть нужную категорию (клик на chevron)
4. Кликнуть на "+ Add" рядом с элементом
5. Элемент появится в списке "Selected Items"
6. Выбрать количество (A lot / Some / Few)
7. Сохранить изменения

### Удаление элемента
1. Найти элемент в "Selected Items"
2. Кликнуть на "×" справа
3. Элемент удалится из списка

### Изменение количества
1. Найти элемент в "Selected Items"
2. Кликнуть на нужную кнопку количества
3. Цвет кнопки изменится (зелёный/жёлтый/оранжевый)

---

**Дата создания:** 15 ноября 2025
**Версия:** 1.0.0
**Статус:** ✅ Готово к использованию

